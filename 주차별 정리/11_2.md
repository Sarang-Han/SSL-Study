## Kernel Adress Space
- Code 영역: 커널 코드 (시스템 콜, 인터럽트 등 처리)
- Data 영역: CPU, mem, disk, PCB 등 하드웨어, 소프트웨어 자원 관리하기 위한 자료구조
- Stack 영역: Process A의 커널 스택, Process B의 커널 스택

## Kernel stack
1. 커널 모드(Kernel Mode): 커널 모드에서 실행되는 프로세스는 모든 시스템 자원과 메모리에 접근할 수 있는 권한을 가지고 있습니다. 이 모드에서 실행되는 코드는 운영체제의 핵심 부분인 커널에 의해 관리되며, 하드웨어를 직접 제어하거나 시스템 설정을 변경하는 등의 작업을 수행할 수 있습니다. 따라서, 커널 모드에서 실행되는 프로세스는 시스템의 안정성과 보안에 매우 중요한 영향을 미칩니다.

2. 유저 모드(User Mode): 유저 모드에서 실행되는 프로세스는 제한된 권한을 가지고 있습니다. 이 모드에서 실행되는 프로세스는 커널이 허용한 범위 내에서만 시스템 자원에 접근할 수 있습니다. 유저 모드에서는 하드웨어를 직접 제어하거나 시스템 설정을 변경하는 등의 작업을 수행할 수 없습니다. 이러한 작업이 필요한 경우, 시스템 콜을 통해 커널에 요청을 보내야 합니다.
이렇게 서로 다른 권한을 가진 두 가지 모드를 운영체제가 사용하는 이유는, 시스템의 안정성과 보안을 유지하기 위함입니다. 유저 모드에서 실행되는 프로세스가 시스템 자원을 잘못 사용하여 시스템에 문제를 일으키는 것을 방지하기 위해, 중요한 시스템 작업은 커널 모드에서만 수행됩니다.

### kernel stack
- 프로세스는 커널의 함수를 호출할 수 있음 (system call)
- kernel은 여러 프로세스가 같이 사용하는 공유 코드
- 프로세스별로 별도의 kernel stack을 둠
    + 프로세스가 시스템 콜로 커널 코드 수행 시 private space 보장
    + 커널 내에서 함수 호출 시 상태 저장

### user stack 
- 일반 사용자 프로세스는 하나의 스택만 존재



## Process States (1 core cpu로 가정)
### Running
- CPU에서 instruction을 수행중인 상태 (cpu 획득)
### Ready
- CPU를 기다리는 상태 (cpu 빼앗김)
### Blocked (wait, sleep)
- I/O 등 오래 걸리는 작업의 완료를 기다리는 상태 (cpu를 줘도 수행 못함)
ex) 디스크에서 파일을 읽어와야 하는 경우, shell이 커맨드를 foreground로 실행시키고 기다리는 경우
### suspended (stopped)
- 외부적인 이유로 프로세스의 수행이 정지된 상태
- 프로세스는 메모리에서 디스크 swap area로 쫓겨남
ex) foreground process에 대해 control-z를 누른 경우

## Process의 실행

프로세스는 스스로 I/O 작업을 수행할 수 없습니다. 이러한 작업은 커널 함수를 통해 호출되어야 합니다.

프로세스의 실행은 사용자 모드(User Mode)와 커널 모드(Kernel Mode) 사이를 전환하며 이루어집니다. 이러한 전환은 시스템 콜(System Call)을 통해 이루어집니다.

CPU는 메모리를 마치 책상처럼 사용하며, 그 위에서 프로그램(프로세스)를 읽어나갑니다. 하지만 CPU는 스스로 읽고 있는 프로그램을 변경할 수 없습니다. 이 때문에, 인터럽트가 필요하게 됩니다. 인터럽트는 타이머 등의 하드웨어를 통해 발생합니다.

인터럽트가 발생하면, 커널은 CPU의 상태를 변경하며 다른 프로세스를 수행할 수 있도록 자원을 조정합니다. 이러한 조정은 커널 스페이스의 data 영역에서 queue를 사용하여 실행 순서를 관리합니다.


*인터럽트
I/O 인터럽트: I/O 장치에서 데이터가 준비되었을 때 발생합니다. 예를 들어, 키보드에서 키를 눌렀을 때, 네트워크 카드에서 패킷을 받았을 때 등입니다.
타이머 인터럽트: 일정 시간이 경과한 후에 발생합니다. 이를 통해 운영체제는 CPU를 다른 프로세스에 할당할 수 있으므로, 특정 프로세스가 CPU를 독점하는 것을 방지합니다.
소프트웨어 인터럽트: 프로그램에서 발생하는 인터럽트로, 예외 상황이나 시스템 콜(System Call) 때문에 발생합니다. 예를 들어, 프로그램이 실행 중에 오류가 발생하거나 시스템 서비스를 요청할 때입니다.
하드웨어 인터럽트: 하드웨어 장치에서 문제가 발생했을 때 발생합니다. 예를 들어, 메모리 에러, 전원 문제, CPU 오류 등 때문에 발생합니다.